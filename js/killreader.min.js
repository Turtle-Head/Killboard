var zkill=function(h,e){var f=new Date();var g=f.getFullYear();var a=f.getMonth()+1;var b="https://zkillboard.com/api/";if(h&&(e==="p")){b+="characterID/"+h}else{if(h&&(e==="c")){b+="corporationID/"+h+"/year/"+g+"/month/"+a+"/"}else{alert("Error parsing ID!")}}var c=setTimeout(function(){alert("Request Timeout: Failed to get kill data")},8000);$.ajax({url:b,dataType:"jsonp",success:function(i){console.log(i);for(var d=0;d<i.length;d++){killArray().push(i[d]);displayKills().push(new Kill(i[d],h))}console.log(killArray());console.log(displayKills());clearTimeout(c)}})};var Kill=function(c,d){console.log(c);var b=this;b.kill=ko.observable(false);b.corp=ko.observable(c.victim.corporationID);b.victim=ko.observable(c.victim.characterName);b.url=ko.observable("http://zkillboard.com/kill/"+c.killID+"/");b.shipPic=ko.observable("http://imageserver.eveonline.com/Render/"+c.victim.shipTypeID+"_128.png");b.atkCorp=ko.observableArray([]);for(var a=0;a<c.attackers.length;a++){b.atkCorp().push({pilotkb:"https://zkillboard.com/character/"+c.attackers[a].characterID+"/",corpPic:"http://imageserver.eveonline.com/Corporation/"+c.attackers[a].corporationID+"_32.png",corp:c.attackers[a].corporationName,pilot:c.attackers[a].characterName,pilotP:"http://imageserver.eveonline.com/Character/"+c.attackers[a].characterID+"_32.jpg",shipPic:"http://imageserver.eveonline.com/Type/"+c.attackers[a].shipTypeID+"_32.png",wepPic:"http://imageserver.eveonline.com/Type/"+c.attackers[a].weaponTypeID+"_32.png",corpKB:"http://zkillboard.com/corporation/"+c.attackers[a].corporationID+"/"})}b.involved=ko.observable(c.attackers.length);b.time=ko.observable(c.killTime);b.vicCorpKB=ko.observable("http://zkillboard.com/corporation/"+c.victim.corporationID+"/");b.isk=ko.observable(Number(c.zkb.totalValue).toLocaleString("en",{minimumFractionDigits:2}));b.kval=ko.observable(c.zkb.totalValue);b.points=ko.observable(c.zkb.points);b.vicCorpUrl=ko.observable("http://imageserver.eveonline.com/Corporation/"+c.victim.corporationID+"_32.png");b.vicPic=ko.observable("http://imageserver.eveonline.com/Character/"+c.victim.characterID+"_128.jpg");if((c.victim.corporationID===d)||(c.victim.characterID===d)){b.kill(false)}else{b.kill(true)}};var killArray=ko.observableArray([]);var displayKills=ko.observableArray([]);var ViewModel=function(){var a=this;a.corporation=ko.observable("98270563");zkill(a.corporation(),"c");a.won=ko.computed(function(){var c;for(var b=0;b<displayKills().length;b++){if(displayKills()[b].kill()){c+=displayKills()[b].kval()}}return c},this);a.lost=ko.computed(function(){var c;for(var b=0;b<displayKills().length;b++){if(!displayKills()[b].kill()){c+=displayKills()[b].kval()}}return c},this);a.balance=ko.computed(function(){return(a.won()-a.lost())},this)};ko.applyBindings(new ViewModel());