var zkill=function(i,f){var g=new Date();var h=g.getFullYear();var a=g.getMonth()+1;var b="https://zkillboard.com/api/";if(data&&(f===p)){i=data;b+="characterID/"+i}else{if(i&&(f===c)){i=data;b+="corporationID/"+i+"/year/"+h+"/month/"+a+"/"}else{if(!i){i=self.corporation();b+="corporationID/"+i+"/year/"+h+"/month/"+a+"/"}}}var e=setTimeout(function(){alert("Request Timeout: Failed to get kill data")},8000);$.ajax({url:b,dataType:"jsonp",success:function(j){if(self.killArray().length!==j.length){self.killArray([]);for(var d=0;d<j.length;d++){self.killArray().push(new kill(j[d]))}}clearTimeout(e)}})};var Kill=function(d){var b=this;b.kill=ko.observable(false);b.corp=ko.observable(d.victim.corporationID);b.victim=ko.observable(d.victim.characterName);b.url=ko.observable("http://zkillboard.com/kill/"+d.killID+"/");b.shipPic=ko.observable("http://imageserver.eveonline.com/Render/"+d.victim.shipTypeID+"_128.png");b.atkCorp=ko.observableArray([]);for(var a=0;a<d.attackers.length;a++){b.atkCorp().push({pilotkb:"https://zkillboard.com/character/"+d.attackers[a].characterID+"/",corpPic:"http://imageserver.eveonline.com/Corporation/"+d.attackers[a].corporationID+"_32.png",corp:d.attackers[a].corporationName,pilot:d.attackers[a].characterName,pilotP:"http://imageserver.eveonline.com/Character/"+d.attackers[a].characterID+"_32.jpg",shipPic:"http://imageserver.eveonline.com/Type/"+d.attackers[a].shipTypeID+"_32.png",wepPic:"http://imageserver.eveonline.com/Type/"+d.attackers[a].weaponTypeID+"_32.png",corpKB:"http://zkillboard.com/corporation/"+d.attackers[a].corporationID+"/"})}b.involved=ko.observable(d.attackers.length);b.time=ko.observable(d.killTime);b.vicCorpKB=ko.observable("http://zkillboard.com/corporation/"+d.victim.corporationID+"/");b.isk=ko.observable(Number(d.zkb.totalValue).toLocaleString("en",{minimumFractionDigits:2}));b.kval=ko.observable(d.zkb.totalValue);b.points=ko.observable(d.zkb.points);b.vicCorpUrl=ko.observable("http://imageserver.eveonline.com/Corporation/"+d.victim.corporationID+"_32.png");b.vicPic=ko.observable("http://imageserver.eveonline.com/Character/"+d.victim.characterID+"_128.jpg");if(d.victim.corporationID===self.corporation()){b.kill(false)}else{b.kill(true)}};var ViewModel=function(){var a=this;a.corporation=ko.observable("98270563");a.killArray=ko.observable([]);zkill(a.corporation,c);$("submit-btn").onClick(zkill());a.won=ko.computed(function(){var d;for(var b=0;b<a.killArray().length;b++){if(a.killArray()[b].kill()){d+=a.killArray()[b].kval()}}return d},this);a.lost=ko.computed(function(){var d;for(var b=0;b<a.killArray().length;b++){if(!a.killArray()[b].kill()){d+=a.killArray()[b].kval()}}return d},this);a.balance=ko.computed(function(){return(a.won()-a.lost())},this)};ko.applybindings(new ViewModel());