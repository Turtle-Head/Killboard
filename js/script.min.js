var UKCR_ID="98270563";var FM_ID="98398761";var LONE_ID="652229108";var displayStats=function(b){var f=b.length;if(f>1){var q=0;for(var v=0;v<f;v++){if(b[q].points<b[v].points){q=v}}var x=0;for(var u=0;u<f;u++){if(b[x].kills<b[u].kills){x=u}}var g=0;for(var s=0;s<f;s++){if(b[g].won<b[s].won){g=s}}var m=0;for(var r=0;r<f;r++){if(b[m].losses<b[r].losses){m=r}}var w="http://imageserver.eveonline.com/Character/"+b[q].id+"_128.png";var c='<tr><td>Points Award</td><td class="pload" id='+b[q].id+"><img src="+w+'></td><td class="pload" id='+b[q].id+"> "+b[q].name+"</td><td>Top Points: "+b[q].points+"</td></tr>";var n="http://imageserver.eveonline.com/Character/"+b[x].id+"_128.png";var a='<tr><td>Kills Award</td><td class="pload" id='+b[x].id+"><img src="+n+'></td><td class="pload" id='+b[x].id+"> "+b[x].name+"</td><td>Top Kills: "+b[x].kills+"</td></tr>";var o="http://imageserver.eveonline.com/Character/"+b[g].id+"_128.png";var e='<tr><td>ISK Award</td><td class="pload" id='+b[g].id+"><img src="+o+'></td><td class="pload" id='+b[g].id+"> "+b[g].name+"</td><td>Top ISK: "+b[g].won+"</td></tr>";var p="http://imageserver.eveonline.com/Character/"+b[m].id+"_128.png";var h='<tr><td>Lemming Award</td><td class="pload" id='+b[m].id+"><img src="+p+'></td><td class="pload" id='+b[m].id+"> "+b[m].name+"</td><td>Top Losses: "+b[m].losses+"</td></tr>";var y=e+c+a+h;$("#statistics").text("");$("#statistics").append(y)}if(f===1){var t="http://imageserver.eveonline.com/Character/"+b[0].id+"_128.png";var d='<tr><td class="pload" id='+b[0].id+">"+t+'</td><td  class="pload" id='+b[0].id+"> "+b[0].name+'</td><td class="cload" id='+b[0].cid+">"+b[0].corp+"</td>";d+="<td>Points: "+b[0].points+"</td><td>Kills: "+b[0].kills+"</td><td>Losses: "+b[0].losses+"</td></tr>";$("#statistics").text("");$("#statistics").append(d)}console.log("Done display")};function findWithAttr(d,a,c){for(var b=0;b<d.length;b+=1){if(d[b][a]===c){return b}}}var stats=function(a,m,b){var r=false;var q=[];if(a===m){r=true}if(r){for(var c=0;c<b.length;c++){if(b[c].victim.corporationID==a){var n=findWithAttr(q,a,b[c].victim.characterID)||null;if(!n){q.push({name:b[c].victim.characterName,id:b[c].victim.characterID,corp:b[c].victim.corporationName,cid:b[c].victim.corporationID,won:0,lost:b[c].zkb.totalValue,points:-b[c].zkb.points,kills:0,losses:1})}if(n){q[n].lost+=b[c].zkb.totalValue;q[n].points-=b[c].zkb.points;q[n].losses+=1}}for(var p=0;p<b[c].attackers.length;p++){if(b[c].attackers[p].corporationID===a){var o=findWithAttr(q,a,b[c].attackers[p].characterID)||null;if(!o){q.push({name:b[c].attackers[p].characterName,id:b[c].attackers[p].characterID,corp:b[c].attackers[p].corporationName,cid:b[c].attackers[p].corporationID,won:b[c].zkb.totalValue,lost:0,points:b[c].zkb.points,kills:1,losses:0})}if(o){q[o].won+=b[c].zkb.totalValue;q[o].points+=b[c].zkb.points;q[o].kills+=1}}}}}if(!r){for(var l=0;l<b.length;l++){if(b[l].victim.characterID==a){var k=findWithAttr(q,a,b[l].victim.characterID)||null;if(!k){q.push({name:b[l].victim.characterName,id:b[l].victim.characterID,corp:b[l].victim.corporationName,cid:b[l].victim.corporationID,won:0,lost:b[l].zkb.totalValue,points:-b[l].zkb.points,kills:0,losses:1})}if(k){q[k].lost+=b[l].zkb.totalValue;q[k].points-=b[l].zkb.points;q[k].losses+=1}}for(var j=0;j<b[l].attackers.length;j++){if(b[l].attackers[j].characterID===a){var d=findWithAttr(q,a,b[l].attackers[j].characterID)||null;if(!d){q.push({name:b[l].attackers[j].characterName,id:b[l].attackers[j].characterID,corp:b[l].attackers[j].corporationName,cid:b[l].attackers[j].corporationID,won:b[l].zkb.totalValue,lost:0,points:b[l].zkb.points,kills:1,losses:0})}if(d){q[d].won+=b[l].zkb.totalValue;q[d].points+=b[l].zkb.points;q[d].kills+=1}}}}}displayStats(q);console.log("Passed to display function");console.log(q);console.log(b)};function loadData(a,g){var f=$("body");var l=$("#results-header");var q=$("#results-articles");var n=$("#greeting");var p=0;var h=0;var o=false;var b;q.text("");l.text("");var c="";var i=new Date();var k=i.getFullYear();var e=i.getMonth()+1;var r="https://zkillboard.com/api/";if(g){r+="corporationID/"+a+"/year/"+k+"/month/"+e+"/"}else{if(!g){r+="characterID/"+a+"/year/"+k+"/month/"+e+"/"}}var j=setTimeout(function(){q.text("Failed to get kill data")},8000);$.ajax({url:r,dataType:"jsonp",success:function(v){console.log(a);$("#month").text(e+"/"+k);var D=v;console.log(D);for(var x=0;x<D.length;x++){articleStr=D[x];var m="http://zkillboard.com/kill/"+articleStr.killID+"/";var w="http://imageserver.eveonline.com/Render/"+articleStr.victim.shipTypeID+"_128.png";var G=[];for(var s=0;s<articleStr.attackers.length;s++){G[s]={pilotkb:"https://zkillboard.com/character/"+articleStr.attackers[s].characterID+"/",corpPic:"http://imageserver.eveonline.com/Corporation/"+articleStr.attackers[s].corporationID+"_32.png",corp:articleStr.attackers[s].corporationName,pilot:articleStr.attackers[s].characterName,pilotP:"http://imageserver.eveonline.com/Character/"+articleStr.attackers[s].characterID+"_32.jpg",shipPic:"http://imageserver.eveonline.com/Type/"+articleStr.attackers[s].shipTypeID+"_32.png",wepPic:"http://imageserver.eveonline.com/Type/"+articleStr.attackers[s].weaponTypeID+"_32.png",corpKB:"http://zkillboard.com/corporation/"+articleStr.attackers[s].corporationID+"/",id:articleStr.attackers[s].characterID,cid:articleStr.attackers[s].corporationID};if(!o){if(Number(a)===Number(articleStr.attackers[s].characterID)){$("#greeting").text(articleStr.attackers[s].characterName);$(".bgimg").attr("src","http://imageserver.eveonline.com/Corporation/"+articleStr.attackers[s].corporationID+"_128.png");b=articleStr.attackers[s].corporationID;o=true;stats(a,b,D)}else{if(Number(a)===Number(articleStr.attackers[s].corporationID)){$("#greeting").text(articleStr.attackers[s].corporationName);$(".bgimg").attr("src","http://imageserver.eveonline.com/Corporation/"+articleStr.attackers[s].corporationID+"_128.png");b=articleStr.attackers[s].corporationID;o=true;stats(a,b,D)}}}}if(!o){if(Number(a)===Number(articleStr.victim.characterID)){$("#greeting").text(articleStr.victim.characterName);$(".bgimg").attr("src","http://imageserver.eveonline.com/Corporation/"+articleStr.victim.corporationID+"_128.png");b=articleStr.victim.corporationID;o=true;stats(a,b,D)}else{if(Number(a)===Number(articleStr.victim.corporationID)){$("#greeting").text(articleStr.victim.corporationName);$(".bgimg").attr("src","http://imageserver.eveonline.com/Corporation/"+articleStr.victim.corporationID+"_128.png");b=articleStr.victim.corporationID;o=true;stats(a,b,D)}}}var y='<div class="num">'+articleStr.killTime+"</div>";var t='<div class="dat" id="inv">Involved: '+(articleStr.attackers.length)+'<div id="atta">';for(var E=0;E<G.length;E++){t+='<img src="'+G[E].shipPic+'"><img src="'+G[E].wepPic+'"><img class="cload" id='+G[E].cid+' src="'+G[E].corpPic+'" alt="'+G[E].corp+'">  <a href="#" class="pload" id='+G[E].id+'><img src="'+G[E].pilotP+'">  '+G[E].pilot+"</a><br>"}t+="</div></div>";var u="http://zkillboard.com/corporation/"+articleStr.victim.corporationID+"/";var C=Number(articleStr.zkb.totalValue).toLocaleString("en",{minimumFractionDigits:2});var F='<div class="dat"><div class="dat2">ISK Value: <div class="num">'+C+'</div></div><div class="dat2"> Points: '+articleStr.zkb.points+"</div>"+y+"</div>";var z="http://imageserver.eveonline.com/Corporation/"+articleStr.victim.corporationID+"_128.png";var B="http://imageserver.eveonline.com/Character/"+articleStr.victim.characterID+"_128.jpg";var d='<td class="image"><a href="'+m+'"><img src="'+w+'"><img src="'+B+'"></a><a href="'+u+'"><img src="'+z+'"></td>';var A='<td class="ids"><a href="#" class="pload" id='+articleStr.victim.characterID+">"+articleStr.victim.characterName+'</a><br> Corp: <a href="#" class="cload" id='+articleStr.victim.corporationID+">"+articleStr.victim.corporationName+"</a>"+F+'</td><td class="attackers">'+t+"</td></tr>";if((Number(articleStr.victim.corporationID)!==Number(a))&&(Number(articleStr.victim.characterID)!==Number(a))){q.append('<tr class="kill">'+d+A);h+=articleStr.zkb.totalValue}else{q.append('<tr class="loss">'+d+A);p+=articleStr.zkb.totalValue}}$("#diff").text("");if((h-p)>0){$("#diff").append('<div class="kill">Kills: '+Number(h).toLocaleString("en",{minimumFractionDigits:2})+' ISK</div><div class="loss">Losses: '+Number(p).toLocaleString("en",{minimumFractionDigits:2})+' ISK</div><div class="kill">[+/-]: '+Number(h-p).toLocaleString("en",{minimumFractionDigits:2})+" ISK</div>")}else{if((h-p)<0){$("#diff").append('<div class="loss">Kills: '+Number(h).toLocaleString("en",{minimumFractionDigits:2})+' ISK</div><div class="loss">Losses: '+Number(p).toLocaleString("en",{minimumFractionDigits:2})+' ISK</div><div class="loss">[+/-]: '+Number(h-p).toLocaleString("en",{minimumFractionDigits:2})+" ISK</div>")}}clearTimeout(j)}});return false}$(document).on("click",".pload",function(){var a=this.id;loadData(a,false)});$(document).on("click",".cload",function(){var a=this.id;loadData(a,true)});$(document).ready(function(){loadData(UKCR_ID,true)});